:root {
    --bg-color: #717292;
    --card-bg-color: #333;
    --popover-bg-color: rgba(74, 74, 74, 0.85);
    --text-color: rgba(255, 255, 255, 1);
    --border-color: #444;
    --text-color-light-gray: #ccc;

    /* Unit Colors */
    --unit-color-vs: #aaaaaa;
    --unit-color-ln: #4455DD;
    --unit-color-mmj: #88DD44;
    --unit-color-vbs: #EE1166;
    --unit-color-wxs: #FF9900;
    --unit-color-n25: #884499;
    --unit-color-oth: #ffffff;
    --unit-color-unk: #aaaaaa;

    /* Difficulty Colors */
    --diff-easy: #11dd77;
    --diff-easy-light: #8aeebc;
    --diff-normal: #33ccff;
    --diff-normal-light: #9ae6ff;
    --diff-hard: #ffcc00;
    --diff-hard-light: #ffe680;
    --diff-expert: #ff4477;
    --diff-expert-light: #ff99b5;
    --diff-master: #cc33ff;
    --diff-master-light: #d99cef;
    --diff-append: #febdf1;
    /* Solid color fallback */
    /* Append Gradient: linear-gradient(to bottom right, #ad92fd, #fe7bde) */
}

.song-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.song-item {
    position: relative;
    display: flex;
    align-items: center;
    background-color: rgba(92, 92, 125, 0.8);
    border-radius: 12px;
    padding: 10px;
    border-bottom: 1px solid var(--border-color);
}

.song-cover-wrapper {
    position: relative;
    z-index: 2;
    flex-shrink: 0;
    cursor: pointer;
}

.song-cover {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 8px;
    border: 3px solid transparent;
    box-sizing: border-box;
}

.unit-border-VS {
    border-color: var(--unit-color-vs);
}

.unit-border-L-n {
    border-color: var(--unit-color-ln);
}

.unit-border-MMJ {
    border-color: var(--unit-color-mmj);
}

.unit-border-VBS {
    border-color: var(--unit-color-vbs);
}

.unit-border-WxS {
    border-color: var(--unit-color-wxs);
}

.unit-border-N25 {
    border-color: var(--unit-color-n25);
}

.unit-border-Oth {
    border-color: var(--unit-color-oth);
}

.unit-border-Unk {
    border-color: var(--unit-color-unk);
}

.song-details {
    position: relative;
    z-index: 1;
    flex-grow: 1;
    padding: 0 1rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 0.75rem;
    min-height: 80px;
}

.song-title-row {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    width: 100%;
}

.song-titles {
    display: flex;
    align-items: baseline;
    flex-wrap: wrap;
}

.title-ko {
    font-size: 1.1rem;
    font-weight: 900;
    white-space: nowrap;
    color: white;
}

.title-jp {
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-color-light-gray);
    margin-left: 0.75rem;
}

.song-bpm {
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-color-light-gray);
    white-space: nowrap;
    margin-left: 1rem;
}

.difficulty-circles {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    align-items: center;
    /* Vertically center bubbles and inline buttons */
}

.circle {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-weight: 900;
    font-size: 1rem;
    transition: transform 0.2s ease;
    box-sizing: border-box;
    cursor: pointer;
    background-color: transparent;
    /* Default transparent for unplayed? Or colored border? Reference uses colored border. */
}

.circle:hover {
    transform: scale(1.1);
}

.circle.easy {
    color: white;
    border: 3.5px solid #13d675;
    /* Keep specific border if different, or use var? 13d675 is close to 11dd77 but darker? Let's stick to var for consistency if possible, or keep if intentional. 13d675 is NOT in my vars. I'll use var(--diff-easy) for consistency or define a new one? The user wants cleanup. I'll use var(--diff-easy) which is #11dd77. Wait, #13d675 is different. */
    /* Actually, let's use the light var for border as seen in other places? No, circle.easy uses #13d675 border. header-circle uses #8aeebc border. */
    /* I will use the variables I defined which match the header/bulk styles. If circle.easy looks different, it might be legacy. I'll standardize it to var(--diff-easy-light) or var(--diff-easy) depending on context. */
    /* circle.easy border was #13d675. header-circle.easy border is #8aeebc. */
    /* I'll use var(--diff-easy) for the main color and var(--diff-easy-light) for the light/border color. */
    border-color: var(--diff-easy);
}

.circle.normal {
    color: white;
    border: 3.5px solid var(--diff-normal);
}

.circle.hard {
    color: white;
    border: 3.5px solid var(--diff-hard);
}

.circle.expert {
    color: white;
    border: 3.5px solid #ff4179;
    /* Custom color? Close to --diff-expert (#ff4477). I'll use var(--diff-expert). */
    border-color: var(--diff-expert);
}

.circle.master {
    color: white;
    border: 3.5px solid #cb34ff;
    /* Close to --diff-master (#cc33ff). I'll use var(--diff-master). */
    border-color: var(--diff-master);
}

.circle.append {
    color: white;
    border: 3.5px solid var(--diff-append);
    background-color: transparent;
}

/* Result background styles - Remove border when filled */
.circle.result-clear,
.circle.result-full_combo,
.circle.result-full_perfect {
    background-origin: padding-box;
    /* Reset background origin if needed */
}

/* Result Colors with Difficulty Borders */
/* We need to target specific combinations of difficulty and result */

/* Easy */
.circle.easy.result-clear,
.circle.easy.result-full_combo,
.circle.easy.result-full_perfect {
    border: 3.5px solid var(--diff-easy-light);
}

/* Normal */
.circle.normal.result-clear,
.circle.normal.result-full_combo,
.circle.normal.result-full_perfect {
    border: 3.5px solid var(--diff-normal-light);
}

/* Hard */
.circle.hard.result-clear,
.circle.hard.result-full_combo,
.circle.hard.result-full_perfect {
    border: 3.5px solid var(--diff-hard-light);
}

/* Expert */
.circle.expert.result-clear,
.circle.expert.result-full_combo,
.circle.expert.result-full_perfect {
    border: 3.5px solid var(--diff-expert-light);
}

/* Master */
.circle.master.result-clear,
.circle.master.result-full_combo,
.circle.master.result-full_perfect {
    border: 3.5px solid var(--diff-master-light);
}

/* Append */
.circle.append.result-clear,
.circle.append.result-full_combo,
.circle.append.result-full_perfect {
    border: 3.5px solid var(--diff-append);
}


/* Background colors for results (keep existing logic but ensure border overrides) */
.result-clear {
    background-color: #FFC107;
    /* Yellow */
    color: black;
}

.result-full_combo {
    background-color: #FF5252;
    /* Red */
    color: white;
}

.result-full_perfect {
    background: linear-gradient(to bottom right, #F06292, #64B5F6);
    /* Pink/Blue Gradient */
    color: white;
    /* Border is handled by specific difficulty rules above */
}

/* Specific fix for Append to remove its gradient border when filled */
/* (Removed redundant reset block) */

.circle.append.result-clear {
    background: #FFC107;
    /* Yellow */
}

.circle.append.result-full_combo {
    background: #FF5252;
    /* Red */
}

.circle.append.result-full_perfect {
    background: linear-gradient(to bottom right, #F06292, #64B5F6);
    /* Pink/Blue Gradient */
}


/* Score Input Header Styles */
.score-input-container {
    font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
    color: var(--text-color);
    min-height: 100vh;
    width: 100%;
    /* Ensure full width */
    max-width: 1000px;
    /* Limit width for centering */
    margin: 0 auto;
    /* Center the container */
    position: relative;
    /* Ensure sticky works within */
    /* box-shadow: 0 0 20px rgba(0, 0, 0, 0.5); */
    /* Optional: add shadow to separate from body bg */
    z-index: 1;
}

/* Background implementation using pseudo-elements on container or body? 
   Since this is a specific page, let's apply it to the container's background 
   but we want it fixed. 
   Actually, the user wants it "same as pjsk-chart-search".
   In pjsk-chart-search, it's on body::before/after.
   We can simulate this by adding a fixed background element inside this container.
*/

.score-input-bg-layer {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 100vh;
    background-image: url('/bg.webp');
    background-size: cover;
    background-position: center;
    z-index: -2;
}

.score-input-overlay-layer {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 100vh;
    background-image:
        linear-gradient(to bottom, rgba(129, 126, 170, 0.8), rgba(92, 92, 125, 0.3) 50%, rgba(92, 92, 125, 0.8)),
        radial-gradient(circle at center, #afb5d5 0%, #adaac3 1.25px, transparent 1.25px),
        radial-gradient(circle at center, #afb5d5 0%, #adaac3 1.25px, transparent 1.25px);
    background-size: 100% 100%, 4px 4px, 4px 4px;
    background-position: 0 0, 0 0, 2px 2px;
    z-index: -1;
    opacity: 0.8;
}

.score-input-header {
    position: sticky;
    top: 0;
    z-index: 1000;

    background-color: rgba(92, 92, 125, 0.95);
    border-radius: 0 0 12px 12px;
    margin: 0;

    padding: 10px 20px 5px 20px;
    /* Reduced padding */

    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    display: flex;
    flex-direction: column;
    gap: 10px;
    /* Reduced gap */
    margin-bottom: 15px;
}

.header-top-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-title {
    margin: 0;
    font-size: 1.1rem;
    /* Slightly smaller */
    font-weight: bold;
}

.header-actions {
    display: flex;
    gap: 8px;
}

.back-button,
.export-button,
.import-button,
.share-button {
    padding: 6px 16px;
    border-radius: 20px !important;
    font-weight: bold;
    cursor: pointer;
    border: none;
    font-size: 0.8rem;
    transition: all 0.2s;
    white-space: nowrap;
}

.back-button,
.export-button,
.import-button {
    background-color: #eaebf3 !important;
    color: #434367 !important;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

.back-button:hover,
.export-button:hover,
.import-button:hover {
    filter: brightness(0.95);
    transform: translateY(-1px);
}

.share-button {
    background-color: #e1bee7;
    /* Light purple for difference */
    color: #4a148c;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

.share-button:hover {
    filter: brightness(0.95);
    transform: translateY(-1px);
}

.import-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.search-input {
    width: 100%;
    padding: 10px;
    /* Smaller padding */
    border-radius: 8px;
    border: 1px solid var(--border-color);
    background-color: #ffffff;
    color: #6a6a6a;
    font-size: 0.95rem;
    font-weight: bold;
    box-sizing: border-box;
}

.search-input:focus {
    outline: none;
    border-color: #64B5F6;
}

/* Difficulty Header Row */
.difficulty-header-row {
    display: flex;
    align-items: center;
    padding: 0 10px;
    /* Match song-item padding */
    margin-top: 5px;
    /* Adjust alignment if needed. User said "slightly left".
       The song-details has padding: 0 1rem.
       Maybe reducing left padding of content slightly? */
    position: relative;
    /* For absolute positioning of instruction if needed, or just flex */
}

.difficulty-header-spacer {
    width: 80px;
    /* Match song-cover width */
    flex-shrink: 0;
}

.difficulty-header-content {
    flex-grow: 1;
    padding: 0 1rem;
    /* Match song-details padding */
    /* To move slightly left, maybe reduce padding-left to 0.8rem if user insists on "left".
       Or maybe the song-details padding is effectively different due to flex gap?
       Let's keep it 1rem for now but ensure box-sizing.
    */
    box-sizing: border-box;
    display: flex;
    /* Make this flex to align labels and instruction */
    align-items: center;
    justify-content: space-between;
    /* Push instruction to right or keep near? User said "right of buttons" */
}

.difficulty-header-labels {
    display: flex;
    gap: 1rem;
    order: 1;
    /* Keep labels first on desktop */
    /* Match difficulty-circles gap */
}

.difficulty-instruction {
    font-size: 0.8rem;
    color: white;
    margin-left: auto;
    /* Push to the right */
    white-space: nowrap;
    padding-left: 10px;
    order: 2;
    /* Keep instruction second on desktop */
}

.header-circle {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-weight: 800;
    font-size: 0.55rem;
    /* Base size for labels */
    color: black;
    box-sizing: border-box;
    text-align: center;
    line-height: 1;
    word-break: break-all;
}

/* Larger font for selected values (numbers) */
.header-circle.has-value {
    font-size: 1.1rem !important;
    /* Larger size for numbers */
    font-weight: 900;
}

/* Adjust font sizes for longer words */
.header-circle.normal,
.header-circle.expert,
.header-circle.master,
.header-circle.append {
    font-size: 0.43rem;
    /* Smaller for longer text */
}

/* Use filled styles for header circles */
/* Use filled styles for header circles */
.header-circle.easy {
    background-color: var(--diff-easy);
    border: 3.5px solid var(--diff-easy-light);
}

.header-circle.normal {
    background-color: var(--diff-normal);
    border: 3.5px solid var(--diff-normal-light);
}

.header-circle.hard {
    background-color: var(--diff-hard);
    border: 3.5px solid var(--diff-hard-light);
}

.header-circle.expert {
    background-color: var(--diff-expert);
    border: 3.5px solid var(--diff-expert-light);
}

.header-circle.master {
    background-color: var(--diff-master);
    border: 3.5px solid var(--diff-master-light);
}

.header-circle.append {
    background: linear-gradient(to bottom right, #ad92fd, #fe7bde);
    border: 3.5px solid var(--diff-append);
}


/* Legend Styles */
.score-legend {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
    /* Removed padding-top as it's now in header row */
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.85rem;
    color: white;
}

.legend-circle {
    width: 20px;
    /* Smaller legend circles */
    height: 20px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 0.65rem;
    font-weight: bold;
}

.legend-circle.clear {
    background-color: #FFC107;
    color: black;
}

.legend-circle.fc {
    background-color: #FF5252;
    color: white;
}

.legend-circle.ap {
    background: linear-gradient(to bottom, #F06292, #64B5F6);
    color: white;
}


.score-popover {
    position: absolute;
    top: 110%;
    left: 50%;
    transform: translateX(-50%);
    /* Center relative to parent circle */
    border: 1px solid #ffffff;
    background-color: rgba(92, 92, 125, 0.95);
    border-radius: 8px;
    padding: 8px;
    display: flex;
    gap: 5px;
    z-index: 100;
    white-space: nowrap;
}

.score-popover::before {
    content: '';
    position: absolute;
    border: 1px solid #ffffff;
    top: -6px;
    left: 50%;
    transform: translateX(-50%);
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 6px solid rgba(92, 92, 125, 0.95);
}

.score-popover button {
    padding: 6px 10px;
    border-radius: 4px;
    border: none;
    background-color: #eaebf3;
    color: #434367;
    cursor: pointer;
    font-size: 12px;
    font-weight: bold;
    transition: all 0.2s;
}

.score-popover button:hover {
    background-color: #555;
    color: white;
}

.score-popover button.active-clear {
    background-color: #FFC107;
    color: black;
    border-color: #FFC107;
}

.score-popover button.active-fc {
    background-color: #FF5252;
    color: white;
    border-color: #FF5252;
}

.score-popover button.active-ap {
    background: linear-gradient(to bottom, #F06292, #64B5F6);
    color: white;
    border: none;
}

/* Inline Score Buttons (Visible when filtered) */
.inline-score-container {
    display: flex;
    align-items: center;
    gap: 20px;
    /* More space between circle and buttons */
    margin-left: 20px;
}

.inline-score-buttons {
    display: flex;
    gap: 12px;
    /* More space between buttons */
}

.inline-score-btn {
    min-width: 20px;
    padding: 6px 16px;
    border: 1px solid #555;
    background-color: transparent;
    border-radius: 20px;
    /* Pill shape for style */
    color: #888;
    font-weight: 700;
    font-size: 0.9rem;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.2s ease;
}

.inline-score-btn:hover {
    border-color: #aaa;
    color: #ddd;
}

/* Active states for inline buttons - Filled when active */
.inline-score-btn.active-clear {
    background-color: #FFC107;
    border-color: #FFC107;
    color: black;
    box-shadow: 0 0 10px rgba(255, 193, 7, 0.4);
}

.inline-score-btn.active-fc {
    background-color: #FF5252;
    border-color: #FF5252;
    color: white;
    box-shadow: 0 0 10px rgba(255, 82, 82, 0.4);
}

.inline-score-btn.active-ap {
    background: linear-gradient(to bottom right, #F06292, #64B5F6);
    border: none;
    /* Gradient handles border */
    color: white;
    box-shadow: 0 0 10px rgba(240, 98, 146, 0.4);
}

.inline-score-btn.active-none {
    background-color: #555;
    border-color: #555;
    color: white;
}


/* Filtered Mode Bubble Styles (Matches Header Bubbles) */
/* We use the same colors as header-circle but apply to circle in filtered mode */
.circle.filtered-style {
    color: black !important;
    /* Text color black like header */
    font-weight: 900;
}

.circle.filtered-style.easy {
    background-color: var(--diff-easy);
    border: 3.5px solid var(--diff-easy-light);
}

.circle.filtered-style.normal {
    background-color: var(--diff-normal);
    border: 3.5px solid var(--diff-normal-light);
}

.circle.filtered-style.hard {
    background-color: var(--diff-hard);
    border: 3.5px solid var(--diff-hard-light);
}

.circle.filtered-style.expert {
    background-color: var(--diff-expert);
    border: 3.5px solid var(--diff-expert-light);
}

.circle.filtered-style.master {
    background-color: var(--diff-master);
    border: 3.5px solid var(--diff-master-light);
}

.circle.filtered-style.append {
    background: linear-gradient(to bottom right, #ad92fd, #fe7bde);
    border: 3.5px solid var(--diff-append);
}

/* Reset Filter Button */
.reset-filter-btn {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    border: none;
    background-color: #eaebf3;
    color: #434367;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.2s;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

.mobile-only {
    display: none;
}

.desktop-only {
    display: flex;
}

.reset-filter-btn:hover {
    filter: brightness(0.95);
    transform: scale(1.1);
}

/* Ensure labels container is relative for absolute positioning of button */
.difficulty-header-labels {
    display: flex;
    gap: 1rem;
    align-items: center;
    /* Vertically center items */
    /* Removed relative positioning as button is now in spacer */
}

/* Spacer should center content (the button) */
.difficulty-header-spacer {
    width: 80px;
    flex-shrink: 0;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Fixed Layout for Song List */
.song-details {
    position: relative;
    z-index: 1;
    flex-grow: 1;
    padding: 0 1rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 0.75rem;
    min-height: 80px;
    min-width: 0;
    /* Crucial for text-overflow to work in flex child */
}

.song-title-row {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    width: 100%;
}

.song-titles {
    display: flex;
    align-items: baseline;
    flex-wrap: nowrap;
    /* Prevent wrapping to keep single line if desired, or allow wrap but constrained */
    overflow: hidden;
    /* Hide overflow */
    text-overflow: ellipsis;
    white-space: nowrap;
    /* Force single line */
    max-width: 100%;
}

.title-ko {
    font-size: 1.1rem;
    font-weight: 900;
    white-space: nowrap;
    color: white;
    overflow: hidden;
    text-overflow: ellipsis;
}

.title-jp {
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-color-light-gray);
    margin-left: 0.75rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Filter Dropdown Styles */
.filter-dropdown {
    position: absolute;
    top: 120%;
    /* Slightly lower */
    left: 50%;
    transform: translateX(-50%);
    background-color: #2a2a2a;
    /* Slightly lighter dark */
    border: 1px solid #444;
    border-radius: 8px;
    padding: 5px;
    z-index: 200;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
    max-height: 400px;
    /* Taller */
    overflow-y: auto;
    min-width: 80px;
    /* Wider */
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.filter-option {
    padding: 10px 15px;
    /* More padding */
    color: #ddd;
    font-size: 1rem;
    cursor: pointer;
    text-align: center;
    border-radius: 4px;
    transition: all 0.2s;
}

.filter-option:hover {
    background-color: #444;
    color: white;
}

.filter-option.selected {
    background-color: #2196F3;
    /* Blue highlight for selected */
    color: white;
    font-weight: bold;
}

/* Scrollbar for dropdown */
.filter-dropdown::-webkit-scrollbar {
    width: 8px;
}

.filter-dropdown::-webkit-scrollbar-track {
    background: #2a2a2a;
    border-radius: 4px;
}

.filter-dropdown::-webkit-scrollbar-thumb {
    background: #555;
    border-radius: 4px;
}

.filter-dropdown::-webkit-scrollbar-thumb:hover {
    background: #777;
}

/* Bulk Input Button */
.bulk-input-btn {
    padding: 6px 12px;
    background-color: #444;
    color: white;
    border: 1px solid #666;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: bold;
    transition: all 0.2s;
}

.bulk-input-btn:hover {
    background-color: #555;
    border-color: #888;
}

/* Bulk Panel (Non-blocking) */
/* Bulk Panel (Non-blocking) */
.bulk-panel {
    background-color: rgba(92, 92, 125, 0.95);
    /* Slight transparency */
    backdrop-filter: blur(10px);
    padding: 20px;
    border-radius: 12px;
    width: 320px;
    /* Fixed width */
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    display: flex;
    flex-direction: column;
    gap: 15px;
    /* Position is set inline in TSX */
}

.bulk-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
}

.bulk-header h3 {
    margin: 0;
    color: white;
    font-size: 1.1rem;
}

.bulk-close-btn {
    background: none;
    border: none;
    color: #eaebf3;
    font-size: 1.2rem;
    cursor: pointer;
    padding: 0;
    line-height: 1;
}

.bulk-close-btn:hover {
    color: white;
}

/* Modal Overlays */
.bulk-modal-overlay,
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: transparent;
    display: flex;
    justify-content: center;
    align-items: center;
}

.bulk-modal-overlay {
    z-index: 2000;
}

.modal-overlay {
    z-index: 3000;
}

/* Modals Common Styles */
.bulk-modal,
.preview-modal,
.share-modal {
    background-color: rgba(92, 92, 125, 0.95);
    padding: 24px;
    border-radius: 16px;
    width: 90%;
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7);
    display: flex;
    flex-direction: column;
    gap: 20px;
    animation: modalFadeIn 0.3s ease-out;
}

@keyframes modalFadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.bulk-modal {
    max-width: 400px;
}

.preview-modal {
    max-width: 500px;
    max-height: 85vh;
    overflow-y: auto;
    /* Enable scrolling */
}

.share-modal {
    max-width: 480px;
}

/* Typography */
.bulk-modal h2,
.preview-modal h2,
.share-modal h2 {
    margin: 0;
    color: white;
    text-align: center;
    font-size: 1.4rem;
    font-weight: 800;
    margin-bottom: 5px;
}

.preview-modal p,
.share-modal p {
    color: #fff;
    text-align: center;
    font-size: 0.95rem;
    margin: 0;
    line-height: 1.5;
}

/* Preview Stats Cards */
.preview-stats {
    display: flex;
    justify-content: space-between;
    gap: 15px;
    margin-top: 10px;
}

.stat-item {
    flex: 1;
    background-color: rgba(0, 0, 0, 0.2);
    padding: 15px;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.stat-item .label {
    font-size: 0.85rem;
    color: #888;
    font-weight: 600;
}

.stat-item .value {
    font-size: 1.3rem;
    font-weight: 900;
    color: white;
}

/* Preview List */
.preview-best39 {
    display: flex;
    flex-direction: column;
    gap: 10px;
    flex: 1;
    min-height: 0;
    /* Important for flex scrolling */
}

.preview-best39 h3 {
    margin: 0;
    font-size: 1rem;
    color: #ccc;
    font-weight: 700;
}

.preview-list {
    flex: 1;
    overflow-y: auto;
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 12px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.preview-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    color: white;
    transition: background-color 0.2s;
    white-space: nowrap;
    /* Ensure single line */
}

.preview-item:hover {
    background-color: #333;
}

.preview-item .rank {
    font-weight: 900;
    color: #ffd700;
    width: 30px;
    text-align: center;
    flex-shrink: 0;
}

.preview-diff {
    font-size: 0.75rem;
    font-weight: 800;
    padding: 2px 0;
    border-radius: 4px;
    color: white;
    width: 40px;
    text-align: center;
    flex-shrink: 0;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
}

.preview-diff.easy {
    background-color: var(--diff-easy);
}

.preview-diff.normal {
    background-color: var(--diff-normal);
}

.preview-diff.hard {
    background-color: var(--diff-hard);
}

.preview-diff.expert {
    background-color: var(--diff-expert);
}

.preview-diff.master {
    background-color: var(--diff-master);
}

.preview-diff.append {
    background: linear-gradient(to bottom right, #ad92fd, #fe7bde);
}

.preview-clear-status {
    font-size: 0.75rem;
    font-weight: 800;
    padding: 2px 0;
    border-radius: 4px;
    width: 40px;
    text-align: center;
    flex-shrink: 0;
    color: white;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
}

.preview-clear-status.P {
    background: linear-gradient(to bottom right, #F06292, #64B5F6);
}

.preview-clear-status.F {
    background-color: #FF5252;
}

.preview-clear-status.C {
    background-color: #FFC107;
    color: black;
    text-shadow: none;
}

.preview-item .title {
    flex: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-size: 0.9rem;
    font-weight: 500;
    margin: 0 5px;
}

.preview-item .score {
    font-weight: 900;
    color: #00e5ff;
    font-size: 1rem;
    width: 45px;
    text-align: right;
    flex-shrink: 0;
}

/* Share Modal specific */
.url-container {
    display: flex;
    gap: 10px;
    background-color: rgba(0, 0, 0, 0.2);
    padding: 8px;
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    margin-top: 10px;
}

.url-container input {
    flex: 1;
    background: transparent;
    border: none;
    color: #ddd;
    font-size: 0.9rem;
    padding: 8px;
    outline: none;
    font-family: monospace;
}

.url-container button {
    background-color: #eaebf3;
    color: #434367;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s;
}

.url-container button:hover {
    background-color: #555;
}

/* Action Buttons */
.preview-actions,
.modal-actions {
    display: flex;
    gap: 12px;
    margin-top: 5px;
}

.preview-btn,
.confirm-btn {
    flex: 1;
    padding: 14px;
    border-radius: 10px;
    border: none;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    transition: transform 0.1s, filter 0.2s;
}

.preview-btn:active,
.confirm-btn:active {
    transform: scale(0.98);
}

.preview-btn.cancel {
    background-color: #eaebf3;
    color: #434367;
}

.preview-btn.cancel:hover {
    background-color: #444;
    color: white;
}

.preview-btn.confirm,
.confirm-btn {
    background-color: #eaebf3;
    color: #434367;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

.preview-btn.confirm:hover,
.confirm-btn:hover {
    filter: brightness(1.1);
    box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
}

/* Mobile Layout Adjustments (Matching pjsk-chart-search) */
@media (max-width: 768px) {
    .score-input-container {
        padding: 1rem;
        min-width: 0;
        width: 100%;
    }

    .score-input-header {
        padding: 10px 1rem 5px 1rem;
        gap: 10px;
        margin-left: -1rem;
        margin-right: -1rem;
        width: calc(100% + 2rem);
        margin-top: -1rem;
    }

    .header-top-row {
        flex-wrap: wrap;
        gap: 10px;
    }

    .score-legend {
        order: 3;
        width: 100%;
        justify-content: center;
        margin-top: 5px;
    }

    .header-actions {
        margin-left: auto;
    }

    /* Song List Adjustments */
    .song-list {
        margin-left: -0.5rem;
        margin-right: -0.5rem;
    }

    .song-item {
        border-radius: 12px;
        min-width: 0;
    }

    .song-cover-wrapper,
    .song-cover {
        width: 60px;
        height: 60px;
        flex-shrink: 0;
    }

    .song-details {
        padding: 0 0.75rem;
        gap: 0.5rem;
        min-width: 0;
        min-height: 0;
        flex-shrink: 1;
    }

    .song-titles {
        flex-shrink: 1;
        min-width: 0;
        display: flex;
        flex-wrap: wrap;
    }

    .title-ko {
        font-size: 0.9rem;
        white-space: normal;
        min-width: 0;
    }

    .title-jp,
    .song-bpm {
        font-size: 0.75rem;
        margin-left: 0.5rem;
    }

    .song-bpm {
        flex-shrink: 0;
    }

    .difficulty-circles {
        gap: 0.75rem;
        flex-wrap: wrap;
        min-width: 0;
    }

    .circle {
        width: 35px;
        height: 35px;
        font-size: 0.95rem;
        border-width: 3.5px;
        flex-shrink: 0;
    }

    /* Header Difficulty Bubbles on Mobile */
    .difficulty-header-row {
        flex-wrap: wrap;
        gap: 2px;
        justify-content: space-between;
        align-items: flex-start;
        padding: 0;
    }

    .difficulty-header-spacer {
        display: none;
    }

    .mobile-only {
        display: flex;
    }

    .desktop-only {
        display: none;
    }

    .difficulty-header-labels {
        gap: 8px;
        flex-wrap: wrap;
        overflow-x: visible;
        justify-content: center;
        max-width: 100%;
        width: 100%;
        /* Ensure it takes full width to center properly */
    }

    .header-circle {
        width: 34px;
        height: 34px;
        font-size: 0.55rem;
        border-width: 2.5px;
        flex-shrink: 0;
    }

    .header-circle.has-value {
        font-size: 0.8rem !important;
    }

    /* Smaller font for longer difficulty names on mobile */
    .header-circle.normal,
    .header-circle.expert,
    .header-circle.master,
    .header-circle.append {
        font-size: 0.38rem;
    }

    .difficulty-right-section {
        width: auto;
        margin-left: auto !important;
        margin-top: 0;
        flex-direction: column;
        align-items: flex-end;
        gap: 2px;
    }

    .difficulty-header-content {
        flex-direction: row;
        /* Keep row for labels */
        align-items: center;
        gap: 4px;
        padding-left: 0;
    }

    .difficulty-instruction.mobile-only {
        display: block;
        font-size: 0.7rem;
        color: white;
        white-space: nowrap;
        text-align: left;
        margin-left: 0;
        font-weight: 600;
    }

    .difficulty-instruction.desktop-only {
        display: none;
    }

    .bulk-input-btn {
        font-size: 0.8rem;
        padding: 4px 8px;
    }

    /* Reduce action button sizes on mobile to prevent wrapping/misalignment */
    .back-button,
    .export-button,
    .import-button,
    .share-button {
        padding: 4px 8px !important;
        font-size: 0.75rem;
    }

    /* Inline buttons on mobile - Removed to use global styles (side-by-side) */

    .inline-score-buttons {
        gap: 8px;
    }

    .inline-score-btn {
        min-width: 36px;
        padding: 6px 12px;
        font-size: 0.8rem;
    }

    /* Fix Dropdown on Mobile (Standard style with wrapping parent) */
    .filter-dropdown {
        /* Revert to default absolute positioning */
        position: absolute;
        top: 120%;
        left: 50%;
        transform: translateX(-50%);
        width: auto;
        min-width: 80px;
        max-height: 300px;
        z-index: 2000;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
    }
}

/* Best 39 Section Layout */
.dashboard-layout {
    display: flex;
    width: fit-content;
    max-width: 1200px;
    /* Adjust as needed */
    margin: 0 auto;
    background-color: #1e1e1e;
    /* Match panel bg */
    border: 1px solid #333;
    border-radius: 8px;
    /* Optional rounded corners for the whole block */
    overflow: hidden;
    /* Clip corners */
}

.left-panel-wrapper {
    width: 360px;
    /* Fixed width for profile/stats */
    flex-shrink: 0;
    border-right: 1px solid #333;
    display: flex;
    flex-direction: column;
}

.best39-section {
    flex-grow: 1;
    width: auto;
    /* Let flex handle width */
    max-width: none;
    /* Override previous max-width */
    margin: 0;
}

/* Small Mobile Adjustments (iPhone SE, etc.) */
@media (max-width: 768px) {
    .dashboard-layout {
        flex-direction: column;
        border: none;
        background-color: transparent;
        width: fit-content;
        /* Wrap content */
        max-width: 100%;
        margin: 0 auto;
        /* Center */
    }

    .left-panel-wrapper {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid #333;
        margin-bottom: 20px;
    }

    .best39-section {
        width: 100%;
    }
}

@media (max-width: 375px) {
    .dashboard-layout {
        width: 100%;
        /* Force full width to accommodate larger content */
    }

    .header-circle {
        width: 35px;
        height: 35px;
        font-size: 0.48rem;
        border-width: 2px;
    }

    .header-circle.normal,
    .header-circle.expert,
    .header-circle.master,
    .header-circle.append {
        font-size: 0.36rem;
    }

    .circle {
        width: 32px;
        height: 32px;
        font-size: 0.85rem;
        border-width: 3px;
    }
}

/* Bulk Input Panel */
.bulk-panel-container {
    position: fixed;
    bottom: 90px;
    right: 20px;
    z-index: 2000;
    animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}



.bulk-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #333;
    padding-bottom: 12px;
    margin-bottom: 4px;
}

.bulk-header h3 {
    margin: 0;
    color: white;
    font-size: 1.1rem;
    font-weight: 800;
}

.bulk-close-btn {
    background: none;
    border: none;
    color: #888;
    font-size: 1.2rem;
    cursor: pointer;
    padding: 4px;
    border-radius: 50%;
    transition: all 0.2s;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.bulk-close-btn:hover {
    background-color: #333;
    color: white;
}

.bulk-section {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.bulk-section label {
    color: #aaa;
    font-size: 0.85rem;
    font-weight: 700;
    margin-left: 4px;
}

.bulk-diff-buttons {
    display: flex;
    gap: 8px;
    justify-content: center;
}

.bulk-diff-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 3px solid transparent;
    background-color: #eaebf3;
    color: #434367;
    font-weight: 800;
    font-size: 0.6rem;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.2s;
}

.bulk-diff-btn:hover {
    transform: scale(1.1);
}

.bulk-diff-btn.selected {
    color: black;
    transform: scale(1.15);
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
}

.bulk-diff-btn.easy.selected {
    background-color: var(--diff-easy);
    border-color: var(--diff-easy-light);
}

.bulk-diff-btn.normal.selected {
    background-color: var(--diff-normal);
    border-color: var(--diff-normal-light);
}

.bulk-diff-btn.hard.selected {
    background-color: var(--diff-hard);
    border-color: var(--diff-hard-light);
}

.bulk-diff-btn.expert.selected {
    background-color: var(--diff-expert);
    border-color: var(--diff-expert-light);
}

.bulk-diff-btn.master.selected {
    background-color: var(--diff-master);
    border-color: var(--diff-master-light);
}

.bulk-diff-btn.append.selected {
    background: linear-gradient(to bottom right, #ad92fd, #fe7bde);
    border-color: var(--diff-append);
}

.bulk-level-range {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    background-color: transparent;
    padding: 10px;
    border-radius: 10px;
}

.bulk-level-range select {
    padding: 8px;
    border-radius: 6px;
    background-color: #eaebf3;
    color: #434367;
    border: none;
    font-size: 1rem;
    width: 80px;
    text-align: center;
    outline: none;
    font-weight: bold;
}

.bulk-result-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
}

.bulk-result-btn {
    padding: 10px 16px;
    border-radius: 8px;
    border: none;
    background-color: #eaebf3;
    color: #434367;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s;
    flex: 1;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

.bulk-result-btn.active.none {
    background-color: #777;
    color: white;
    border-color: #999;
}

.bulk-result-btn.active.clear {
    background-color: #FFC107;
    color: black;
    border-color: #FFC107;
}

.bulk-result-btn.active.fc {
    background-color: #FF5252;
    color: white;
    border-color: #FF5252;
}

.bulk-result-btn.active.ap {
    background: linear-gradient(to bottom right, #F06292, #64B5F6);
    color: white;
    border: none;
}

.bulk-actions {
    margin-top: 10px;
}

.bulk-apply-btn {
    width: 100%;
    padding: 14px;
    border-radius: 10px;
    border: none;
    font-weight: 800;
    font-size: 1rem;
    cursor: pointer;
    background: linear-gradient(135deg, #2196F3, #1976D2);
    color: white;
    box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
    transition: all 0.2s;
}

.bulk-apply-btn:hover {
    filter: brightness(1.1);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
}

@media (max-width: 768px) {
    .bulk-panel-container {
        right: 10px;
        left: 10px;
        bottom: 80px;
        width: auto;
        display: flex;
        justify-content: center;
    }

    .bulk-panel {
        width: 100%;
        max-width: 400px;
    }
}

/* Per-Song Bulk Input Styles */
.song-bulk-btn {
    background-color: #eaebf3;
    color: #434367;
    border: none;
    padding: 4px 8px;
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s;
    margin-left: 8px;
    white-space: nowrap;
}

.song-bulk-btn:hover {
    background-color: #555;
    color: white;
}

.fixed-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 999;
    background: transparent;
}

/* Right-aligned popover arrow adjustment */
.score-popover.right-aligned::before {
    left: auto;
    right: 14px;
    /* Align with center of button (approx) */
    transform: none;
}

/* Profile Edit Form Styles */
.profile-edit-form {
    display: flex;
    flex-direction: column;
    gap: 16px;
    width: 100%;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.form-group label {
    color: #aaa;
    font-size: 0.9rem;
    font-weight: 600;
}

.form-group input {
    background-color: #333;
    border: 1px solid #555;
    color: white;
    padding: 12px;
    border-radius: 8px;
    font-size: 1rem;
    outline: none;
    transition: border-color 0.2s;
}

.form-group input:focus {
    border-color: #888;
}

/* Fix for date/time inputs in dark mode */
.form-group input[type="date"],
.form-group input[type="time"] {
    color-scheme: dark;
    width: 150px;
    font-family: inherit;
}

@media (max-width: 375px) {
    .preview-modal {
        width: 95%;
        padding: 16px;
        max-height: 90vh;
    }

    .date-time-group {
        flex-direction: row;
        gap: 5px !important;
    }

    .form-group input {
        padding: 8px;
        font-size: 0.85rem;
    }

}

@media (max-width: 350px) {

    .back-button,
    .export-button,
    .import-button,
    .share-button {
        padding: 4px 6px !important;
        font-size: 0.7rem !important;
    }
}

.desktop-instruction-container {
    display: flex;
    align-items: center;
    gap: 10px;
}

.bulk-input-trigger-btn {
    background: #eaebf3;
    border: none;
    border-radius: 20px;
    color: #434367 !important;
    font-size: 0.8rem;
    cursor: pointer;
    padding: 6px 16px !important;
    outline: none;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    transition: all 0.2s;
    white-space: nowrap;
    font-weight: bold;
}

.bulk-input-trigger-btn:hover {
    filter: brightness(1.1);
    box-shadow: 0 4px 8px rgba(33, 150, 243, 0.4);
    transform: translateY(-1px);
}

.bulk-input-trigger-btn.mobile {
    font-size: 0.8rem !important;
    padding: 4px 8px !important;
    margin-right: 5px
}

/* Song Info Popover (Ported from pjsk-chart-search) */
.song-info-popover {
    position: absolute;
    top: 0;
    left: 0;
    min-width: 180px;

    padding: 0.5rem 0.75rem;
    background-color: rgba(74, 74, 74, 0.85);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);

    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 0.5rem;

    color: white;
    animation: fadeIn 0.15s ease-in-out;
    z-index: 10;
    pointer-events: none;
    text-align: left;
}

.popover-column {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.8rem;
    font-weight: 600;
}

.popover-column span {
    white-space: nowrap;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: scale(0.95);
    }

    to {
        opacity: 1;
        transform: scale(1);
    }
}

@media (max-width: 768px) {
    .song-info-popover {
        left: 0;
        min-width: 150px;
    }
}